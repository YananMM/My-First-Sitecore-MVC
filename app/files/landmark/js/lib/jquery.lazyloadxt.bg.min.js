/*! Lazy Load XT v1.0.6 2014-11-19
 * http://ressio.github.io/lazy-load-xt
 * (C) 2014 RESS.io
 * Licensed under MIT */

(function ($) {
    var options = $.lazyLoadXT,
        bgAttr = options.bgAttr || 'data-bg';

    options.selector += ',[' + bgAttr + ']';

    if(/IE 8.0/.test(navigator.userAgent)){
        $(document).on('lazyshow', function (e) {
            var $this = $(e.target),
                src = $this.attr(bgAttr);
                
            if (src) {
            	var boxW = $this.width(),
            		boxH = $this.height(),
    				tmpimg = new Image();

    			tmpimg.onload = function(){
    	        	var	imgW = tmpimg.width, imgH = tmpimg.height,
    	        		fitW = Math.max(boxW, Math.floor(boxH * imgW/imgH)),
    	        		fitH = Math.max(boxH, Math.floor(boxW * imgH/imgW));

                    $img = $('<img src="'+ src + '">').appendTo($this);
            		$img.css({
                        'max-width': 'none',
                        'max-height': 'none',
            			'width': fitW,
            			'height': fitH,
            			'margin-left': (boxW - fitW) /2,
            			'margin-top': (boxH - fitH) /2
            		});
    			};
                tmpimg.src = src;
            }
            $this.removeAttr(bgAttr);
        });
	} else {
        $(document).on('lazyshow', function (e) {
            var $this = $(e.target),
                src = $this.attr(bgAttr);
                
            if (src) {
                $this.css('background-image', "url('" + src + "')")
            }

            $this.removeAttr(bgAttr).addClass('lazy-loaded');
        });
	}
})(window.jQuery || window.Zepto || window.$);