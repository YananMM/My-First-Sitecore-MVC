@using Landmark.Classes
@using Landmark.Helper
@using Sitecore.Data.Fields
@using Sitecore.Data.Items
@using Landmark.Models
@using Sitecore.Collections
@model RenderingModel
@{
    MagezineHelper helper = new MagezineHelper();
    var parent = Sitecore.Context.Item.Parent;
    var stories = helper.GetStoriesByPager(Request["type"], Convert.ToInt32(Request["page"]));
    List<Item> list1 = new ItemList();
    List<Item> list2 = new ItemList();

}

<div class="container">
    <div class="gd-pagetitle">
        <div class="gd-pagetitle-heading">
            <h2>@parent["Page Title"].ToUpper()</h2>
        </div>
        @Html.Sitecore().Rendering(ItemGuids.T36CategoryTypeViewGuid, new
            {
                Cacheable = false,
                CacheKey = "category-type",
                Cache_VaryByData = true,
            })
    </div>
    <div class="gd-magazine-info">
        <div class="row">
            @if (stories.Count() != 0)
            {
                <div class="col-sm-6">
                    <img data-src="@Html.Sitecore().ImageFieldSrc("Callout Image", stories.First())">
                </div>
                <div class="col-sm-6">
                    <div class="gd-magazine-info-text">
                        <h3>@Html.Sitecore().Field("Story Name", stories.First())</h3>
                        @{
                DateField storyDate = stories.First().Fields["Story Date"];
                var date = LandmarkHelper.ToValidDateTime(storyDate);
                        }
                        <h5>@date.ToString("MMM yyyy", System.Globalization.CultureInfo.InvariantCulture)</h5>
                        <p>@Html.Sitecore().Field("Story Content", stories.First())</p>
                    </div>
                </div>
            }
        </div>
    </div>
    @{
        if (string.IsNullOrEmpty(Request["page"]) || Convert.ToInt32(Request["page"]) == 1)
        {
            var storyList = stories.GetRange(1, stories.Count - 1).ToList();
            if (storyList.Count >= 3)
            {
                list1 = storyList.GetRange(0, 3);
                list2 = storyList.GetRange(3, storyList.Count - 3);
            }
            else
            {
                list1 = storyList;
            }
            <h2>@storyList.Count</h2>
        }
    }
    <h2>@list1.Count</h2>
    <h2>@list2.Count</h2>
    <h2>@stories.Count</h2>
    <div class="gd-promotion-box-area">
        <div class="row">
            @if (list1.Count != 0)
            {
                foreach (var item in list1)
                {
                    <div class="col-sm-4">
                        <div class="gd-promotion-box">
                            <img data-src="@Html.Sitecore().ImageFieldSrc("Callout Image", item)">
                            <h4><a href="#">@Html.Sitecore().Field("Story Name", item)</a></h4>
                            @{
                    DateField itemDate = item.Fields["Story Date"];
                    var itemdate = LandmarkHelper.ToValidDateTime(itemDate);
                            }
                            <h5>@itemdate.ToString("MMM yyyy", System.Globalization.CultureInfo.InvariantCulture)</h5>
                            <p>@Html.Sitecore().Field("Story Content", item)</p>
                        </div>
                    </div>
                }
            }
        </div>
        <div class="row">
            @if (list2.Count != 0)
            {
                foreach (var item in list2)
                {
                    <div class="col-sm-4">
                        <div class="gd-promotion-box">
                            <img data-src="@Html.Sitecore().ImageFieldSrc("Callout Image", item)">
                            <h4><a href="#">@Html.Sitecore().Field("Story Name", item)</a></h4>
                            @{
                    DateField itemDate = item.Fields["Story Date"];
                    var itemdate = LandmarkHelper.ToValidDateTime(itemDate);
                            }
                            <h5>@itemdate.ToString("MMM yyyy", System.Globalization.CultureInfo.InvariantCulture)</h5>
                            <p>@Html.Sitecore().Field("Story Content", item)</p>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
    <div class="gd-promo-more"><a href="?type=@Request["type"]&page=2">@Html.Sitecore().Field("Glossary Value", ItemGuids.SeeMoreItem) +</a></div>
</div>
